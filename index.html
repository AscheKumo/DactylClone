<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Dactyl (Recreation)</title>

<link rel="preload" as="image" href="Bomb%20UnLit.png">
<link rel="preload" as="image" href="Bomb%20Lit.png">

<style>
  :root{
    --bg:#0a0a0a;
    --panel:#0f0f0f;
    --grid-bg:#111;
    --text:#eaeaea;

    --seg-off:#1a1a1a;
    --seg-on:#e61b1b;
    --seg-stroke:#0b0b0b;
  }

  *{box-sizing:border-box;}
  body{
    margin:0;
    min-height:100vh;
    background:var(--bg);
    color:var(--text);
    font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    padding:18px;
  }

  .container{
    width:min(440px, 96vw);
    text-align:center;
  }

  h1{
    margin:0 0 10px;
    font-weight:650;
    letter-spacing:3px;
  }

  .topbar{
    display:flex;
    gap:10px;
    align-items:center;
    justify-content:space-between;
    background:var(--panel);
    border:1px solid #222;
    padding:10px;
    border-radius:10px;
    margin-bottom:10px;
  }

  .scores{
    display:flex;
    gap:12px;
    align-items:flex-end;
  }

  .scoreBox{ text-align:left; }

  .label{
    font-size:11px;
    opacity:.75;
    letter-spacing:1px;
    margin-bottom:4px;
  }

  .seg{
    width:108px;
    height:34px;
    display:block;
  }

  .controls{
    display:flex;
    gap:8px;
    justify-content:flex-end;
    align-items:center;
  }

  select,button{
    background:#111;
    color:#fff;
    border:1px solid #333;
    padding:8px 10px;
    font-size:14px;
    border-radius:8px;
  }

  button{ cursor:pointer; }

  .grid{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    grid-template-rows:repeat(4,1fr);
    gap:10px;
    background:var(--grid-bg);
    padding:10px;
    border-radius:12px;
    border:1px solid #1d1d1d;
  }

  .bomb{
    width:100%;
    aspect-ratio:1 / 1;
    background-image:url("Bomb%20UnLit.png");
    background-size:contain;
    background-repeat:no-repeat;
    background-position:center;
    transition:transform .06s ease, filter .08s ease;
    touch-action:manipulation;
    user-select:none;
  }

  .bomb:active{ transform:scale(.96); }
  .bomb.active{ background-image:url("Bomb%20Lit.png"); }
  .bomb.explode{
    background-image:url("Bomb%20Lit.png");
    filter:brightness(1.4);
  }

  .status{ margin-top:10px; font-size:14px; opacity:.85; }
  .hint{ margin-top:6px; font-size:12px; opacity:.55; }

  @media (max-width:420px){
    body{ padding:12px; align-items:flex-start; }
    .topbar{ flex-direction:column; }
    select,button{ width:49%; }
  }
</style>
</head>

<body>
<div class="container">
  <h1>DACTYL</h1>

  <div class="topbar">
    <div class="scores">
      <div class="scoreBox">
        <div class="label">CURRENT</div>
        <svg class="seg" id="segCurrent" viewBox="0 0 216 68"></svg>
      </div>
      <div class="scoreBox">
        <div class="label">HIGH</div>
        <svg class="seg" id="segHigh" viewBox="0 0 216 68"></svg>
      </div>
    </div>

    <div class="controls">
      <select id="difficulty">
        <option value="easy">Easy</option>
        <option value="normal" selected>Normal</option>
        <option value="hard">Hard</option>
        <option value="insane">Insane</option>
      </select>
      <button id="btnStart">Start</button>
    </div>
  </div>

  <div class="grid" id="grid"></div>
  <div class="status" id="status">Tap the lit bombs before they explode.</div>
  <div class="hint">Hard/Insane: touching an unlit bomb explodes.</div>
</div>

<script>
document.addEventListener("contextmenu", e => e.preventDefault());

const grid = document.getElementById("grid");
const statusText = document.getElementById("status");
const difficultySelect = document.getElementById("difficulty");
const btnStart = document.getElementById("btnStart");

const GRID_SIZE = 12;
const DIGITS = 5;

let bombs=[], activeBombs=[];
let running=false, spawnTimeout=null;
let score=0, highScore=0, lastSpawnIndex=-1;

const DIFFICULTY = {
  easy:   { spawnStart:1200, fuseStart:3600, spawnMin:520, fuseMin:1600, rampPerPoint:0.9992 },
  normal: { spawnStart:900,  fuseStart:2800, spawnMin:420, fuseMin:1300, rampPerPoint:0.9991 },
  hard:   { spawnStart:650,  fuseStart:2200, spawnMin:340, fuseMin:1050, rampPerPoint:0.9990 },
  insane: { spawnStart:500,  fuseStart:1800, spawnMin:280, fuseMin:900,  rampPerPoint:0.9988 }
};

function getTimings(){
  const d = DIFFICULTY[difficultySelect.value];
  const factor = Math.pow(d.rampPerPoint, score);
  return {
    spawn: Math.max(d.spawnMin, Math.round(d.spawnStart * factor)),
    fuse:  Math.max(d.fuseMin,  Math.round(d.fuseStart  * factor))
  };
}

function createGrid(){
  grid.innerHTML="";
  bombs=[]; activeBombs=[]; lastSpawnIndex=-1;

  for(let i=0;i<GRID_SIZE;i++){
    const d=document.createElement("div");
    d.className="bomb";
    d.addEventListener("pointerdown", e=>{
      e.preventDefault();
      tapBomb(i);
    });
    grid.appendChild(d);
    bombs.push({ el:d, active:false, timer:null, index:i });
  }
}

function scheduleNext(){
  if(!running) return;
  const { spawn, fuse } = getTimings();
  spawnTimeout=setTimeout(()=>{
    activateBomb(fuse);
    scheduleNext();
  }, spawn);
}

function startGame(){
  stopGame();
  createGrid();
  score=0;
  running=true;
  statusText.textContent="Stay alive.";
  const { fuse } = getTimings();
  activateBomb(fuse);
  scheduleNext();
}

function stopGame(){
  running=false;
  clearTimeout(spawnTimeout);
  bombs.forEach(b=>clearTimeout(b.timer));
  activeBombs=[];
}

function activateBomb(fuse){
  let pool=bombs.filter(b=>!b.active && b.index!==lastSpawnIndex);
  if(!pool.length) pool=bombs.filter(b=>!b.active);
  if(!pool.length) return;

  const b=pool[Math.floor(Math.random()*pool.length)];
  b.active=true;
  b.el.classList.add("active");
  activeBombs.push(b);
  lastSpawnIndex=b.index;

  b.timer=setTimeout(()=>explode(b),fuse);
  if(activeBombs.length>=4) explode(activeBombs[0]);
}

function tapBomb(i){
  const b=bombs[i];
  if(!running) return;

  if(b.active){
    clearTimeout(b.timer);
    b.active=false;
    b.el.classList.remove("active");
    activeBombs=activeBombs.filter(x=>x!==b);
    score++;
    return;
  }

  // NEW RULE: touching unlit bomb on hard/insane explodes
  if(difficultySelect.value === "hard" || difficultySelect.value === "insane"){
    explode(b);
  }
}

function explode(b){
  b.el.classList.add("explode");
  statusText.textContent="BOOM.";
  stopGame();
}

btnStart.onclick=startGame;
createGrid();
</script>
</body>
</html>
